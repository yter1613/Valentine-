<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Валентинка</title>

<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=Marck+Script&display=swap" rel="stylesheet">

<style>
:root{
  --mx: 43%;
  --my: 60%;
  --maskSize: 0px;
  --waveDuration: 4200ms;

  --gold: #ffe6bf;
  --shadowDark: rgba(0,0,0,.92);
  --shadowGlow: rgba(255,210,140,.55);
}

html,body{
  margin:0;
  height:100%;
  background:#07040b;
  overflow:hidden;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
}

.wrap{
  height:100%;
  display:grid;
  place-items:center;
  padding:12px;
}

.card{
  position:relative;
  width:min(92vw,520px);
  aspect-ratio:2730/4096;
  border-radius:18px;
  overflow:hidden;
  box-shadow:0 20px 70px rgba(0,0,0,.55);
  background:#000;
}

.layer{
  position:absolute;
  inset:0;
  background-size:cover;
  background-position:center;
}

.layer.start{
  background-image:url("./start.png");
  transition:filter var(--waveDuration) ease;
}

.layer.final{
  background-image:url("./full_2x.png");

  -webkit-mask-image:
    radial-gradient(circle at var(--mx) var(--my),
      rgba(0,0,0,1) 0%,
      rgba(0,0,0,1) 55%,
      rgba(0,0,0,0) 75%);
  mask-image:
    radial-gradient(circle at var(--mx) var(--my),
      rgba(0,0,0,1) 0%,
      rgba(0,0,0,1) 55%,
      rgba(0,0,0,0) 75%);

  -webkit-mask-repeat:no-repeat;
  mask-repeat:no-repeat;

  -webkit-mask-size:var(--maskSize) var(--maskSize);
  mask-size:var(--maskSize) var(--maskSize);

  filter:none;
  transition:-webkit-mask-size var(--waveDuration) ease, mask-size var(--waveDuration) ease;
}

canvas#petals{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  pointer-events:none;
}

.counter{
  position:absolute;
  top:16px;
  left:16px;
  opacity:0;
  transition:opacity 900ms ease;
  z-index:4;
  font-family:'Cinzel',serif;
  color:var(--gold);
  text-shadow:
    0 2px 0 var(--shadowDark),
    0 0 16px var(--shadowGlow),
    0 12px 28px rgba(0,0,0,.85);
}

.card.show-ui .counter{ opacity:1; }

.bottom-text{
  position:absolute;
  left:50%;
  bottom:24px;
  transform:translateX(-50%) translateY(20px);
  opacity:0;
  transition:opacity 1200ms ease, transform 1200ms ease;
  width:92%;
  text-align:center;
  font-family:'Marck Script',cursive;
  font-size:clamp(20px,5vw,34px);
  line-height:1.05;
  color:var(--gold);
  text-shadow:
    0 2px 0 var(--shadowDark),
    0 0 18px var(--shadowGlow),
    0 18px 35px rgba(0,0,0,.85);
}

.card.show-ui .bottom-text{
  opacity:1;
  transform:translateX(-50%) translateY(0);
}
</style>
</head>

<body>
<div class="wrap">
<div class="card" id="card">

<div class="layer start"></div>
<div class="layer final"></div>

<canvas id="petals"></canvas>

<div class="counter">
  <div>Мы вместе</div>
  <div id="together">—</div>
</div>

<div class="bottom-text">
  Случайная встреча — возможность любви
</div>

</div>
</div>

<script>
const card = document.getElementById('card');
const canvas = document.getElementById('petals');
const ctx = canvas.getContext('2d');

function resize(){
  canvas.width = card.clientWidth;
  canvas.height = card.clientHeight;
}
resize();
window.addEventListener('resize',resize);

// Таймер
const startDate = new Date(2025,4,26);
const togetherEl = document.getElementById('together');
function updateTimer(){
  const now=new Date();
  let diff=Math.max(0,now-startDate);
  const d=Math.floor(diff/86400000); diff-=d*86400000;
  const h=Math.floor(diff/3600000); diff-=h*3600000;
  const m=Math.floor(diff/60000); diff-=m*60000;
  const s=Math.floor(diff/1000);
  togetherEl.textContent=`${d} дней ${h} часов ${m} минут ${s} секунд`;
}
setInterval(updateTimer,1000);
updateTimer();

// Волна
function startMagic(){
  card.style.setProperty('--maskSize','0px');
  card.classList.add('alive');
  requestAnimationFrame(()=>{
    const size=Math.hypot(card.clientWidth,card.clientHeight)*2.3;
    card.style.setProperty('--maskSize',size+'px');
  });
  setTimeout(()=>card.classList.add('show-ui'),900);
}
card.addEventListener('pointerdown',startMagic);

// --- ПАДАЮЩИЕ СЕРДЕЧКИ ---

const petals=[];
const maxPetals=22;

function createPetal(){
  return{
    x:Math.random()*canvas.width,
    y:-20,
    size:6+Math.random()*8,
    speed:0.6+Math.random()*1.2,
    sway:Math.random()*2,
    angle:Math.random()*Math.PI*2,
    life:0,
    maxLife:6+Math.random()*4
  };
}

function drawHeart(x,y,size,alpha){
  ctx.save();
  ctx.translate(x,y);
  ctx.scale(size/10,size/10);
  ctx.globalAlpha=alpha;
  ctx.fillStyle="rgba(255,170,190,0.9)";
  ctx.beginPath();
  ctx.moveTo(0,3);
  ctx.bezierCurveTo(0,-3,-5,-3,-5,1);
  ctx.bezierCurveTo(-5,5,0,7,0,9);
  ctx.bezierCurveTo(0,7,5,5,5,1);
  ctx.bezierCurveTo(5,-3,0,-3,0,3);
  ctx.fill();
  ctx.restore();
}

function animate(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  if(petals.length<maxPetals && Math.random()<0.08){
    petals.push(createPetal());
  }

  for(let i=petals.length-1;i>=0;i--){
    const p=petals[i];
    p.y+=p.speed;
    p.x+=Math.sin(p.angle+=0.02)*p.sway;
    p.life+=0.016;

    const alpha=1-(p.life/p.maxLife);

    drawHeart(p.x,p.y,p.size,alpha);

    if(p.y>canvas.height+20 || p.life>p.maxLife){
      petals.splice(i,1);
    }
  }

  requestAnimationFrame(animate);
}

animate();
</script>
</body>
</html>
